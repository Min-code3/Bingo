<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>ì˜¤ì‚¬ì¹´ ì—¬í–‰ ë¹™ê³ </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    /* === RESET & VARS === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --red: #B91C1C;
      --dark-red: #7F1D1D;
      --gold: #D4A574;
      --gold-light: #F5E6D0;
      --cream: #F5F0E8;
      --paper: #FAF7F2;
      --dark: #1C1917;
    }

    body {
      font-family: 'Noto Serif KR', 'Georgia', serif;
      background: var(--cream);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
    }

    /* === SIDEBAR === */
    .sidebar {
      width: 240px;
      background: var(--dark-red);
      color: #fff;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      flex-shrink: 0;
      /* ì‚¬ì´ë“œë°” ì¤„ì–´ë“¤ì§€ ì•Šê²Œ ê³ ì • */
    }

    .sidebar h1 {
      font-size: 1.4rem;
      text-align: center;
      border-bottom: 2px solid var(--gold);
      padding-bottom: 14px;
    }

    .nav-btn {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--gold);
      background: transparent;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 4px;
      transition: all .3s;
    }

    .nav-btn.active {
      background: var(--gold);
      color: var(--dark);
    }

    .progress-section {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, .2);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gold);
      width: 0%;
      transition: width .5s;
    }

    .reset-btn {
      margin-top: 10px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.3);
      border: none;
      color: #fff;
      cursor: pointer;
    }

    /* === MAIN CONTENT === */
    .main-content {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      height: 100vh;
    }

    .main-content h2 {
      font-size: 2rem;
      color: var(--dark-red);
      margin-bottom: 10px;
    }

    .subtitle {
      color: #555;
      margin-bottom: 20px;
      font-size: 0.95rem;
    }

    /* === BINGO GRID (ìˆ˜ì •ë¨) === */
    .bingo-grid {
      display: grid;
      gap: 10px;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }

    /* 1ì—´ í¬ê¸° ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ minmax(0, 1fr) ì‚¬ìš© */
    .main-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-template-rows: repeat(3, minmax(0, 1fr));
      grid-template-areas:
        "c1 c2 c3"
        "c4 food food"
        "c7 food food";
      aspect-ratio: 1 / 1;
      /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ ê°•ì œ */
    }

    .food-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-template-rows: repeat(3, minmax(0, 1fr));
      aspect-ratio: 1 / 1;
    }

    /* === CELL === */
    .cell {
      position: relative;
      width: 100%;
      height: 100%;
      perspective: 1000px;
      cursor: pointer;
    }

    .cell[data-area="c1"] {
      grid-area: c1;
    }

    .cell[data-area="c2"] {
      grid-area: c2;
    }

    .cell[data-area="c3"] {
      grid-area: c3;
    }

    .cell[data-area="c4"] {
      grid-area: c4;
    }

    .cell[data-area="food"] {
      grid-area: food;
    }

    .cell[data-area="c7"] {
      grid-area: c7;
    }

    .card {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      border-radius: 8px;
      overflow: hidden;
      background: #fff;
      border: 2px solid var(--red);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* === FRONT (íƒ€ê²Ÿ ì´ë¯¸ì§€) === */
    .card-front {
      z-index: 2;
    }

    .target-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.9;
    }

    .cell-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      transition: opacity 0.3s;
    }

    .cell-title {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 4px;
    }

    .cell-sub {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    /* === BACK (ìœ ì € ì—…ë¡œë“œ ì‚¬ì§„) === */
    .card-back {
      transform: rotateY(180deg);
      background: var(--dark);
      position: relative;
    }

    .user-photo {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* === UPLOAD CONTROLS (ì¹´ë“œ ë‚´ë¶€) === */
    .upload-controls {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 10;
    }

    /* ëª¨ë°”ì¼ì—ì„œëŠ” í•­ìƒ ì•½ê°„ ë³´ì´ê²Œ í•˜ê±°ë‚˜ í„°ì¹˜ì‹œ ë³´ì´ê²Œ ì²˜ë¦¬ */
    .card-back:hover .upload-controls,
    .card-back.active .upload-controls {
      opacity: 1;
    }

    .mini-btn {
      background: var(--gold);
      color: var(--dark);
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .mini-btn:hover {
      background: #fff;
    }

    /* === DETAIL MODAL (ë°±ì—”ë“œ ë°ì´í„° í‘œì‹œìš©) === */
    .detail-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .detail-modal.active {
      display: flex;
    }

    .detail-card {
      background: #fff;
      width: 100%;
      max-width: 500px;
      border-radius: 12px;
      overflow: hidden;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .detail-header {
      position: relative;
      height: 200px;
      background: #eee;
    }

    .detail-header img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .detail-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .detail-body {
      padding: 20px;
      overflow-y: auto;
    }

    .detail-title {
      font-size: 1.5rem;
      color: var(--dark-red);
      margin-bottom: 10px;
      font-weight: 900;
    }

    .detail-desc {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #444;
      margin-bottom: 20px;
      white-space: pre-wrap;
    }

    .info-box {
      background: var(--paper);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
    }

    .klook-link {
      display: block;
      text-align: center;
      background: #FF5722;
      color: #fff;
      text-decoration: none;
      padding: 12px;
      border-radius: 8px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .map-container {
      width: 100%;
      height: 200px;
      background: #eee;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .map-frame {
      width: 100%;
      height: 100%;
      border: 0;
    }

    .action-area {
      border-top: 1px solid #eee;
      padding: 20px;
      text-align: center;
      background: #fafafa;
    }

    .upload-trigger {
      background: var(--red);
      color: #fff;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(185, 28, 28, 0.3);
    }

    /* === Hidden File Input === */
    #hiddenFileInput {
      display: none;
    }

    /* === RESPONSIVE === */
    @media(max-width:768px) {
      body {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        padding: 10px;
        flex-direction: row;
        align-items: center;
        gap: 10px;
        height: auto;
        min-height: 60px;
      }

      .sidebar h1 {
        font-size: 1.1rem;
        border: none;
        padding: 0;
        margin-right: auto;
      }

      .nav-btn {
        width: auto;
        padding: 6px 12px;
        font-size: 0.8rem;
      }

      .progress-section {
        display: none;
      }

      .main-content {
        padding: 10px;
      }

      .bingo-grid {
        gap: 6px;
      }

      .cell-title {
        font-size: 0.8rem;
      }

      .cell-sub {
        font-size: 0.7rem;
      }
    }
  </style>
</head>

<body>

  <aside class="sidebar">
    <h1>ğŸ‡¯ğŸ‡µ ì˜¤ì‚¬ì¹´ ë¹™ê³ </h1>
    <div class="progress-section">
      <div>
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;font-size:0.9rem;">
          <span>ì§„í–‰ë¥ </span>
          <span id="progText">0/6</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progBar"></div>
        </div>
      </div>
      <button class="reset-btn" onclick="resetData()">ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>
  </aside>

  <main class="main-content">
    <div id="mainView" style="width:100%;display:flex;flex-direction:column;align-items:center;">
      <h2>ì˜¤ì‚¬ì¹´ ëª…ì†Œ ë¹™ê³ </h2>
      <p class="subtitle">ì‚¬ì§„ì„ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
      <div class="bingo-grid main-grid" id="mainGrid"></div>
    </div>

    <div id="foodView" style="display:none;width:100%;flex-direction:column;align-items:center;">
      <button onclick="showMain()"
        style="margin-bottom:15px;background:none;border:none;font-size:1rem;cursor:pointer;">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      <h2>ì˜¤ì‚¬ì¹´ ë¨¹ë°© ë¹™ê³ </h2>
      <div class="bingo-grid food-grid" id="foodGrid"></div>
    </div>
  </main>

  <div class="detail-modal" id="detailModal">
    <div class="detail-card">
      <div class="detail-header">
        <img id="d-img" src="">
        <button class="detail-close" onclick="closeDetail()">Ã—</button>
      </div>
      <div class="detail-body">
        <h3 id="d-title" class="detail-title">ì¥ì†Œ ì´ë¦„</h3>
        <p id="d-desc" class="detail-desc">ì„¤ëª… í…ìŠ¤íŠ¸...</p>

        <a id="d-klook" href="#" target="_blank" class="klook-link">ğŸŸï¸ í´ë£©ì—ì„œ í‹°ì¼“ ì˜ˆë§¤í•˜ê¸°</a>

        <div class="map-container">
          <iframe id="d-map" class="map-frame" loading="lazy" allowfullscreen></iframe>
        </div>
      </div>
      <div class="action-area">
        <button class="upload-trigger" onclick="triggerUpload()">ğŸ“· ì¸ì¦ìƒ· ì˜¬ë¦¬ê¸°</button>
      </div>
    </div>
  </div>

  <input type="file" id="hiddenFileInput" accept="image/*" onchange="handleFileSelect(event)">

  <script>
    // ===== ì„¤ì • ë° ë°ì´í„° (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì—ì„œ ë°›ì•„ì˜¬ ë°ì´í„° êµ¬ì¡°) =====
    // targetImg: ë¹™ê³ ì¹¸ì— í‘œì‹œë  ëª©í‘œ ì´ë¯¸ì§€ URL (í˜„ì¬ëŠ” ì˜ˆì‹œìš© Unsplash URL)
    const MAIN_DATA = [
      { id: 'wild', label: 'ììœ  ì—¬í–‰', sub: 'ì•„ë¬´ê³³ì´ë‚˜', area: 'c1', targetImg: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=400&q=80' },
      { id: 'umeda', label: 'ìš°ë©”ë‹¤', sub: 'ìŠ¤ì¹´ì´ë¹Œë”©', area: 'c2', targetImg: 'https://images.unsplash.com/photo-1590253230538-4b7b25e791e3?w=400&q=80' },
      { id: 'osaka', label: 'ì˜¤ì‚¬ì¹´ì„±', sub: 'ì²œìˆ˜ê°', area: 'c3', targetImg: 'https://images.unsplash.com/photo-1590559313204-454d89a69146?w=400&q=80' },
      { id: 'glico', label: 'ë„í†¤ë³´ë¦¬', sub: 'ê¸€ë¦¬ì½”ìƒ', area: 'c4', targetImg: 'https://images.unsplash.com/photo-1599413208757-377df5003c27?w=400&q=80' },
      { id: 'food', label: 'ë¨¹ë°© ë¹™ê³ ', sub: 'í´ë¦­í•˜ì—¬ ì´ë™', area: 'food', targetImg: 'https://images.unsplash.com/photo-1583561633465-38b434440539?w=400&q=80', isMega: true },
      { id: 'tsuten', label: 'ì¸ í…ì¹´ì¿ ', sub: 'ì‹ ì„¸ì¹´ì´', area: 'c7', targetImg: 'https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=400&q=80' }
    ];

    const FOOD_DATA = [
      { id: 'f1', label: 'íƒ€ì½”ì•¼í‚¤', targetImg: 'https://images.unsplash.com/photo-1604561726002-31518b5b7c7b?w=300' },
      { id: 'f2', label: 'ì˜¤ì½”ë…¸ë¯¸ì•¼ë¼', targetImg: 'https://images.unsplash.com/photo-1592358892523-a21350a04977?w=300' },
      { id: 'f3', label: 'ë¼ë©˜', targetImg: 'https://images.unsplash.com/photo-1591814468924-caf88d1232e1?w=300' },
      { id: 'f4', label: 'ê·œì¹´ì¸ ', targetImg: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=300' },
      { id: 'f5', label: 'ì•¼ë¼í† ë¦¬', targetImg: 'https://images.unsplash.com/photo-1594221708779-94832f4320d1?w=300' },
      { id: 'f6', label: 'ìŠ¤ì‹œ', targetImg: 'https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=300' },
      { id: 'f7', label: 'í¸ì˜ì ', targetImg: 'https://images.unsplash.com/photo-1634547903698-c8df59f518b8?w=300' },
      { id: 'f8', label: 'ë””ì €íŠ¸', targetImg: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=300' },
      { id: 'f9', label: 'ë§¥ì£¼', targetImg: 'https://images.unsplash.com/photo-1567696911980-2c0c978002df?w=300' },
    ];

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤
    const SKEY = 'osaka_bingo_v2';
    let STATE = loadState();
    let currentModalContext = null; // í˜„ì¬ ì—´ë¦° ëª¨ë‹¬ì˜ ì •ë³´ {type, index}

    function loadState() {
      try {
        const s = localStorage.getItem(SKEY);
        if (s) return JSON.parse(s);
      } catch (e) { }
      return {
        main: Array(6).fill({ done: false, photo: null }),
        food: Array(9).fill({ done: false, photo: null })
      };
    }
    function saveState() { localStorage.setItem(SKEY, JSON.stringify(STATE)); }

    // ì´ˆê¸°í™”
    window.onload = () => {
      renderMain();
      renderFood();
      updateProgress();
    };

    // === ë Œë”ë§ ë¡œì§ ===
    function renderMain() {
      const grid = document.getElementById('mainGrid');
      grid.innerHTML = '';
      MAIN_DATA.forEach((item, idx) => {
        const st = STATE.main[idx];
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.area = item.area;

        // ë©”ê°€ ì…€(ìŒì‹) ì²˜ë¦¬
        if (item.isMega) {
          const doneCount = STATE.food.filter(f => f.done).length;
          cell.onclick = () => showFood();
          cell.innerHTML = `
        <div class="card">
          <div class="card-face card-front">
            <img src="${item.targetImg}" class="target-img">
            <div class="cell-overlay" style="background:rgba(185,28,28,0.7)">
              <div class="cell-title">${item.label}</div>
              <div class="cell-sub">${doneCount}/9 ì™„ë£Œ</div>
            </div>
          </div>
        </div>`;
          return grid.appendChild(cell);
        }

        // ì¼ë°˜ ì…€
        const isDone = st && st.done;
        cell.innerHTML = `
      <div class="card ${isDone ? 'flipped' : ''}">
        <div class="card-face card-front" onclick="openDetail('main', ${idx})">
          <img src="${item.targetImg}" class="target-img">
          <div class="cell-overlay">
            <div class="cell-title">${item.label}</div>
            <div class="cell-sub">${item.sub}</div>
          </div>
        </div>
        <div class="card-face card-back">
          <img src="${isDone ? st.photo : ''}" class="user-photo">
          <div class="upload-controls">
            <button class="mini-btn" onclick="openDetail('main', ${idx})">ğŸ”„ ì‚¬ì§„ ë³€ê²½</button>
          </div>
        </div>
      </div>
    `;
        grid.appendChild(cell);
      });
    }

    function renderFood() {
      const grid = document.getElementById('foodGrid');
      grid.innerHTML = '';
      FOOD_DATA.forEach((item, idx) => {
        const st = STATE.food[idx];
        const isDone = st && st.done;
        const cell = document.createElement('div');
        cell.className = 'cell';

        cell.innerHTML = `
      <div class="card ${isDone ? 'flipped' : ''}">
        <div class="card-face card-front" onclick="openDetail('food', ${idx})">
          <img src="${item.targetImg}" class="target-img">
          <div class="cell-overlay">
            <div class="cell-title">${item.label}</div>
          </div>
        </div>
        <div class="card-face card-back">
          <img src="${isDone ? st.photo : ''}" class="user-photo">
          <div class="upload-controls">
            <button class="mini-btn" onclick="openDetail('food', ${idx})">ğŸ”„ ì‚¬ì§„ ë³€ê²½</button>
          </div>
        </div>
      </div>
    `;
        grid.appendChild(cell);
      });
    }

    // === ìƒì„¸ ëª¨ë‹¬ & ë°±ì—”ë“œ ì‹œë®¬ë ˆì´ì…˜ ===
    function openDetail(type, idx) {
      currentModalContext = { type, idx };
      const data = type === 'main' ? MAIN_DATA[idx] : FOOD_DATA[idx];

      // ë¡œë”© ìƒíƒœ í‘œì‹œ (ì˜µì…˜)
      document.getElementById('d-title').innerText = "Loading...";
      document.getElementById('detailModal').classList.add('active');

      // ë°±ì—”ë“œ ë°ì´í„° ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜
      fetchCellDetail(data.id).then(info => {
        document.getElementById('d-img').src = data.targetImg;
        document.getElementById('d-title').innerText = data.label;
        document.getElementById('d-desc').innerText = info.description;

        const klookBtn = document.getElementById('d-klook');
        if (info.klookUrl) {
          klookBtn.href = info.klookUrl;
          klookBtn.style.display = 'block';
        } else {
          klookBtn.style.display = 'none';
        }

        // êµ¬ê¸€ë§µ (ì„ë² ë“œ URL ë°©ì‹ ì‚¬ìš©)
        // ì‹¤ì œë¡œëŠ” Google Maps JavaScript APIë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ìœ„ë„/ê²½ë„ë¥¼ ë°›ì•„ì™€ì•¼ í•¨
        const mapFrame = document.getElementById('d-map');
        mapFrame.src = `https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY_HERE&q=${encodeURIComponent(info.mapQuery)}`;
        // ì£¼ì˜: API KEYê°€ ì—†ìœ¼ë©´ ì‘ë™í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë°ëª¨ìš©ìœ¼ë¡œëŠ” ê°„ë‹¨í•œ ê²€ìƒ‰ ë§í¬ë¡œ ëŒ€ì²´í•˜ê±°ë‚˜ ìœ„ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
        // í˜„ì¬ëŠ” API í‚¤ ì—†ì´ ì‘ë™í•˜ëŠ” ë‹¨ìˆœ iframe map ì˜ˆì‹œ(Embed API ì•„ë‹˜)ë¡œ ëŒ€ì²´ ë¶ˆê°€í•˜ì—¬(êµ¬ê¸€ ì •ì±… ë³€ê²½), 
        // ì•„ë˜ì™€ ê°™ì´ 'ì§€ë„ ê²€ìƒ‰ ê²°ê³¼'ë¥¼ ë³´ì—¬ì£¼ëŠ” ë°©ì‹ì€ iframe ê±°ë¶€ê°€ ë§ìŠµë‹ˆë‹¤. 
        // ë”°ë¼ì„œ ì—¬ê¸°ì„œëŠ” 'ë°ëª¨ìš©'ìœ¼ë¡œë§Œ ë†”ë‘ê³ , ì‹¤ì œ êµ¬í˜„ ì‹œ API Keyë¥¼ ë„£ì–´ì•¼ í•¨ì„ ì£¼ì„ìœ¼ë¡œ ë‚¨ê¹ë‹ˆë‹¤.
        // ì„ì‹œë¡œ ì´ë¯¸ì§€ë¥¼ ëŒ€ì²´í•˜ê² ìŠµë‹ˆë‹¤.
        if (type === 'main' && idx === 0) { // Wild ì¹´ë“œ ì˜ˆì™¸ì²˜ë¦¬
          mapFrame.src = "about:blank";
        } else {
          // ì—¬ê¸°ì„œëŠ” ë°ëª¨ë¥¼ ìœ„í•´ API Keyê°€ í•„ìš”ì—†ëŠ” ì˜ˆì „ ë°©ì‹ì€ ë§‰í˜”ìœ¼ë¯€ë¡œ, ë¹ˆ í™”ë©´ í˜¹ì€ ì—ëŸ¬ê°€ ëœ° ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: https://console.cloud.google.com/ ì—ì„œ API Key ë°œê¸‰ í•„ìš”.
        }
      });
    }

    // [MOCK API] ë°±ì—”ë“œ DB ì—­í• ì„ í•˜ëŠ” í•¨ìˆ˜
    function fetchCellDetail(id) {
      return new Promise(resolve => {
        // ì‹¤ì œë¡œëŠ” fetch('/api/bingo/detail?id='+id) ...
        setTimeout(() => {
          const mockDB = {
            'wild': { desc: "ì˜¤ì‚¬ì¹´ ì–´ë””ë“  ìƒê´€ì—†ìŠµë‹ˆë‹¤. ì—¬í–‰ ì¤‘ ê°€ì¥ ì¸ìƒ ê¹Šì€ ìˆœê°„ì„ ì°ì–´ì£¼ì„¸ìš”!", klookUrl: "", mapQuery: "Osaka" },
            'umeda': { desc: "ìš°ë©”ë‹¤ ìŠ¤ì¹´ì´ ë¹Œë”© ê³µì¤‘ì •ì› ì „ë§ëŒ€ì…ë‹ˆë‹¤.\nì•¼ê²½ì´ íŠ¹íˆ ì•„ë¦„ë‹¤ìš´ ê³³ì…ë‹ˆë‹¤.", klookUrl: "https://www.klook.com/ko/activity/1302-umeda-sky-building-osaka/", mapQuery: "Umeda Sky Building" },
            'osaka': { desc: "ì˜¤ì‚¬ì¹´ì˜ ëœë“œë§ˆí¬ ì˜¤ì‚¬ì¹´ì„±ì…ë‹ˆë‹¤.\nì²œìˆ˜ê° ì•ì—ì„œ ì¸ì¦ìƒ·ì„ ì°ì–´ë³´ì„¸ìš”.", klookUrl: "https://www.klook.com/ko/activity/16016-osaka-castle-ticket-osaka/", mapQuery: "Osaka Castle" },
            'glico': { desc: "ë„í†¤ë³´ë¦¬ì˜ ìƒì§• ê¸€ë¦¬ì½”ìƒì…ë‹ˆë‹¤.\nê°™ì€ í¬ì¦ˆë¡œ ì‚¬ì§„ì„ ì°ëŠ” ê²ƒì´ êµ­ë£°!", klookUrl: "", mapQuery: "Dotonbori Glico Man" },
            'tsuten': { desc: "ì‹ ì„¸ì¹´ì´ì˜ ìƒì§• ì¸ í…ì¹´ì¿ ì…ë‹ˆë‹¤.\në ˆíŠ¸ë¡œí•œ ë¶„ìœ„ê¸°ë¥¼ ëŠê»´ë³´ì„¸ìš”.", klookUrl: "https://www.klook.com/ko/activity/2899-tsutenkaku-tower-admission-ticket-osaka/", mapQuery: "Tsutenkaku" },
            // ìŒì‹...
            'f1': { desc: "ì˜¤ì‚¬ì¹´ëŠ” íƒ€ì½”ì•¼í‚¤ì˜ ë³¸ê³ ì¥! ê²‰ë°”ì†ì´‰ íƒ€ì½”ì•¼í‚¤ë¥¼ ë“œì„¸ìš”.", mapQuery: "Osaka Takoyaki" },
            // ...ë‚˜ë¨¸ì§€ ìƒëµ (ê¸°ë³¸ê°’ ë¦¬í„´)
          };
          resolve(mockDB[id] || { desc: "ë§›ìˆëŠ” ìŒì‹ì„ ì¦ê¸°ê³  ì¸ì¦ìƒ·ì„ ë‚¨ê¸°ì„¸ìš”!", mapQuery: "Osaka Restaurant", klookUrl: "" });
        }, 300); // 0.3ì´ˆ ë”œë ˆì´ ì‹œë®¬ë ˆì´ì…˜
      });
    }

    function closeDetail() {
      document.getElementById('detailModal').classList.remove('active');
      currentModalContext = null;
    }

    // === íŒŒì¼ ì—…ë¡œë“œ ë¡œì§ ===
    function triggerUpload() {
      document.getElementById('hiddenFileInput').click();
    }

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file || !currentModalContext) return;

      const reader = new FileReader();
      reader.onload = function (ev) {
        const result = ev.target.result;

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        const { type, idx } = currentModalContext;
        if (type === 'main') {
          STATE.main[idx].done = true;
          STATE.main[idx].photo = result;
        } else {
          STATE.food[idx].done = true;
          STATE.food[idx].photo = result;
        }
        saveState();

        // UI ì—…ë°ì´íŠ¸ (ë¦¬ë Œë”ë§)
        if (type === 'main') renderMain();
        else renderFood();

        closeDetail();
        updateProgress();
      };
      reader.readAsDataURL(file);
    }

    // === ë·° ì „í™˜ ===
    function showFood() {
      document.getElementById('mainView').style.display = 'none';
      document.getElementById('foodView').style.display = 'flex';
      renderFood();
    }
    function showMain() {
      document.getElementById('foodView').style.display = 'none';
      document.getElementById('mainView').style.display = 'flex';
      renderMain(); // ìƒíƒœ ë°˜ì˜ì„ ìœ„í•´ ì¬ë Œë”ë§
    }

    // === ê¸°íƒ€ ===
    function updateProgress() {
      const count = STATE.main.filter(x => x.done).length;
      const pct = (count / 6) * 100;
      document.getElementById('progBar').style.width = pct + '%';
      document.getElementById('progText').innerText = count + '/6';
    }
    function resetData() {
      if (confirm('ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        localStorage.removeItem(SKEY);
        location.reload();
      }
    }
  </script>
</body>

</html>